# SoundSphere — Development Guide

## Project Vision
SoundSphere is a practice and progress tracking platform designed for musicians, athletes, and learners.
The goal is to record sessions, visualize growth, and create a structured practice journey.

The project follows an **MVP-first approach**: start with essential tracking functions, then expand into visualization, social, and gamification features.

---

## Development Phases

### Phase 1 — MVP
- Practice session CRUD (Create, Read, Update, Delete)
- Basic user authentication (JWT / OAuth2 with Google)
- PostgreSQL with Flyway migrations
- REST API with Spring Boot
- Frontend UI (React + Vite)
- Docker Compose for local dev
- CI/CD with GitHub Actions (build + test)

### Phase 2 — Extensions
- Progress visualization (charts, timeline)
- Advanced session tags (instrument, technique, mood)
- Social features (friend list, sharing)
- Notifications / reminders

### Phase 3 — Growth
- Observability (OpenTelemetry + Actuator)
- Recommendation engine (AI-based suggestions)
- Mobile support (KMP or Flutter)
- Community features

---

## Tech Stack

- **Backend**: Spring Boot 3.x (Java 21), JPA, Flyway
- **Frontend**: React + Vite
- **Database**: PostgreSQL (test env: H2 in-memory)
- **Auth**: JWT + OAuth2 (Google Login)
- **Infra**: Docker Compose, GitHub Actions CI/CD
- **Observability**: Spring Actuator, OpenTelemetry

---

## Development Practices

### Branch Strategy
- **Trunk-Based Development**
  - `main`: production-ready
  - `feat/*`: feature branches → PR → main
- Optional: `dev` for integration testing

### Commit Convention
Using [Conventional Commits](https://www.conventionalcommits.org/):
- `feat: add PracticeSession entity`
- `fix: resolve merge conflict in test config`
- `chore: update CI pipeline`

### Code Style
- Backend: MVC + Service Layer + Repository
- DTOs and Requests separated from Entities
- Enable Lombok for boilerplate reduction
- RESTful API design, versioned as `/api/v1/...`

### Testing
- Unit tests with JUnit5 & MockMvc
- Integration tests with H2 in-memory DB
- Flyway disabled in test context, schema generated by Hibernate

---

## Architecture Rules
1. **Separation of concerns**: Controller ↔ Service ↔ Repository
2. **Database schema tracked with Flyway** (never manual SQL outside migration files)
3. **Environment variables** stored in `.env`, never commit secrets
4. **CI must pass** before merging PR
5. **PR reviews** required before merge to `main`

---

## Current Implementation Status

### Completed (Phase 1 - MVP)
- [x] Project structure setup with Spring Boot 3.5.6 + Java 21
- [x] Practice session CRUD API (`/api/sessions`)
- [x] PostgreSQL integration with Docker Compose
- [x] Flyway database migrations (V1__init.sql)
- [x] Environment variable configuration (.env)
- [x] CI/CD pipeline with GitHub Actions
- [x] Unit tests (Service layer)
- [x] Integration tests (Controller + Repository)
- [x] Docker Compose setup for local development
- [x] Startup script (start.sh) for easy development

### In Progress
- [ ] User authentication (JWT)
- [ ] OAuth2 integration (Google Login)
- [ ] Frontend UI (React + Vite)

### Planned (Phase 1 - MVP)
- [ ] API versioning (`/api/v1/...`)
- [ ] DTOs and Request/Response objects
- [ ] Input validation
- [ ] Error handling and custom exceptions
- [ ] API documentation (Swagger/OpenAPI)
- [ ] Logging improvements

---

## Quick Development Commands

### Start Development Environment
```bash
# Start database
docker compose up -d

# Run application
./start.sh

# Or manually
POSTGRES_DB=soundsphere POSTGRES_USER=postgres POSTGRES_PASSWORD=postgres ./gradlew bootRun
```

### Testing
```bash
# Run all tests
./gradlew test

# Run specific test
./gradlew test --tests PracticeSessionControllerTest

# Run with coverage
./gradlew test jacocoTestReport
```

### Database Operations
```bash
# Access PostgreSQL
docker compose exec postgres psql -U postgres -d soundsphere

# View logs
docker compose logs postgres

# Reset database
docker compose down -v
docker compose up -d
```

### Git Workflow
```bash
# Create feature branch
git checkout -b feat/user-authentication

# Commit with conventional commits
git commit -m "feat: add JWT authentication"

# Push and create PR
git push origin feat/user-authentication
```

---

## API Endpoints (Current)

### Practice Sessions
- `GET /api/sessions` - Get all sessions
- `GET /api/sessions/{id}` - Get session by ID
- `POST /api/sessions` - Create new session
- `PUT /api/sessions/{id}` - Update session
- `DELETE /api/sessions/{id}` - Delete session

### Health & Monitoring
- `GET /actuator/health` - Health check
- `GET /actuator/info` - Application info
- `GET /actuator/metrics` - Metrics

---

## Development Guidelines for AI Assistants

When working on this project, please:

1. **Follow the architecture**: Always maintain MVC separation (Controller → Service → Repository)
2. **Use environment variables**: Never hardcode credentials or sensitive data
3. **Write tests**: Every new feature should have unit and integration tests
4. **Follow commit conventions**: Use conventional commits format
5. **Update migrations**: Database changes must go through Flyway migrations
6. **Check CI**: Ensure all tests pass before pushing
7. **Document APIs**: Update this file when adding new endpoints
8. **Security first**: Validate inputs, sanitize outputs, use prepared statements

### Code Review Checklist
- [ ] Tests written and passing
- [ ] No hardcoded credentials
- [ ] Flyway migration created (if DB changes)
- [ ] Environment variables used properly
- [ ] Error handling implemented
- [ ] Logging added for important operations
- [ ] API documented
- [ ] CI pipeline passing

---

## Security Notes

- Database credentials stored in `.env` (gitignored)
- `.env.example` provides template for contributors
- CI uses H2 in-memory database (no credentials needed)
- Production secrets should use GitHub Secrets or vault solutions

---

## Resources

- [Spring Boot Documentation](https://spring.io/projects/spring-boot)
- [Flyway Documentation](https://flywaydb.org/documentation)
- [Conventional Commits](https://www.conventionalcommits.org/)
- [Docker Compose Documentation](https://docs.docker.com/compose/)

---

## Next Steps

### Immediate (Phase 1 completion)
- [ ] Add API versioning (/api/v1/sessions)
- [ ] Implement DTOs for request/response
- [ ] Add input validation with @Valid
- [ ] Implement JWT authentication
- [ ] Add Swagger/OpenAPI documentation
- [ ] Create error handling framework

### Short-term (Phase 2 preparation)
- [ ] Set up frontend project structure (React + Vite)
- [ ] Design database schema for user tags and categories
- [ ] Plan visualization features (charts library selection)
- [ ] Research social features architecture

### Long-term (Phase 2-3)
- [ ] Implement OAuth2 with Google
- [ ] Build progress visualization
- [ ] Add observability with OpenTelemetry
- [ ] Design recommendation engine

---

**Last Updated**: 2025-10-17
**Current Phase**: Phase 1 (MVP) - 70% Complete